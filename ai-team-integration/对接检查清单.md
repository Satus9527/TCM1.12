# 对接检查清单

**项目**: TCM Platform × Colab AI  
**创建日期**: 2025年11月2日  
**用途**: 跟踪双方对接进度

---

## ✅ 后端团队已完成

- [x] 分析API契约差异（M5 vs Colab）
- [x] 修改P4推荐逻辑（序列化+解析）
- [x] 修改P5分析逻辑（序列化+解析）
- [x] 实现降级方案
- [x] 完整错误处理
- [x] 日志记录完善
- [x] 代码测试通过（本地Mock）
- [x] 创建API要求文档
- [x] 创建测试用例文档
- [x] 创建部署文档

**代码提交日期**: 2025年11月2日

---

## ⏳ 后端团队待办

- [ ] 等待AI团队提供Colab URL
- [ ] 更新`.env`配置
- [ ] 执行集成测试
- [ ] 验证降级方案
- [ ] 性能测试
- [ ] 生产环境部署

---

## 📋 AI团队待办

### 高优先级（必须在联调前完成）

- [ ] **确认API格式理解**
  - [ ] 阅读`API要求文档.md`
  - [ ] 确认标记格式理解正确
  - [ ] 如有疑问，与后端沟通

- [ ] **实现格式规范**
  - [ ] 推荐服务返回`辨证为：[xxx]。方剂ID：[yyy]。`
  - [ ] 分析服务返回`<JSON_START>...<JSON_END>`
  - [ ] 格式严格匹配要求

- [ ] **验证JSON格式**
  - [ ] 确保JSON标记内是有效JSON
  - [ ] 无JSON语法错误
  - [ ] 数据类型正确

- [ ] **部署Colab服务**
  - [ ] 使用ngrok创建隧道
  - [ ] 确保服务稳定运行
  - [ ] 测试所有端点

### 中优先级（建议联调前完成）

- [ ] **执行自测用例**
  - [ ] 运行`测试用例.md`中的所有用例
  - [ ] 记录测试结果
  - [ ] 修复发现的问题

- [ ] **性能优化**
  - [ ] 首次请求时间 < 30秒
  - [ ] 后续请求时间 < 5秒
  - [ ] 优化响应速度

- [ ] **建立URL通知机制**
  - [ ] 确定通知渠道（邮件/Slack/钉钉）
  - [ ] 每次重启后发送最新URL
  - [ ] 设置自动提醒（如果可能）

### 低优先级（可以联调后完善）

- [ ] **错误处理完善**
  - [ ] 清晰的错误消息
  - [ ] 错误代码规范
  - [ ] 异常情况处理

- [ ] **监控和日志**
  - [ ] 添加访问日志
  - [ ] 记录处理时间
  - [ ] 错误日志记录

---

## 🔄 联调测试清单

### 阶段1: 基本连通性（1天）

- [ ] **网络连通**
  - [ ] 后端能访问Colab URL
  - [ ] 健康检查端点正常
  - [ ] 无防火墙阻断

- [ ] **格式验证**
  - [ ] 推荐标记格式正确
  - [ ] 分析标记格式正确
  - [ ] JSON格式正确

- [ ] **基本功能**
  - [ ] P4推荐成功
  - [ ] P5分析成功
  - [ ] 无解析错误

### 阶段2: 完整性测试（2天）

- [ ] **边界情况**
  - [ ] 空症状处理
  - [ ] 长文本处理
  - [ ] 特殊字符处理

- [ ] **错误处理**
  - [ ] 超时处理
  - [ ] 网络错误
  - [ ] 格式错误

- [ ] **降级方案**
  - [ ] 标记缺失时降级
  - [ ] JSON无效时降级
  - [ ] 前端显示正常

### 阶段3: 性能测试（1天）

- [ ] **响应时间**
  - [ ] P4平均响应
  - [ ] P5平均响应
  - [ ] 首次请求时间

- [ ] **并发测试**
  - [ ] 多个同时请求
  - [ ] WebSocket并发
  - [ ] 无阻塞

- [ ] **稳定性**
  - [ ] 连续运行12小时
  - [ ] 无崩溃
  - [ ] 内存稳定

### 阶段4: 生产验证（1天）

- [ ] **部署验证**
  - [ ] 生产环境配置
  - [ ] SSL证书正常
  - [ ] 日志正常

- [ ] **端到端测试**
  - [ ] 前端调用成功
  - [ ] 用户体验良好
  - [ ] 无异常

- [ ] **监控设置**
  - [ ] 添加监控指标
  - [ ] 设置告警
  - [ ] 建立运维流程

---

## 📊 进度跟踪

### 整体进度

```
后端准备: ████████████████████ 100%
AI准备:   ██░░░░░░░░░░░░░░░░░░  20%
联调测试: ░░░░░░░░░░░░░░░░░░░░   0%
生产部署: ░░░░░░░░░░░░░░░░░░░░   0%
```

### 时间线

| 阶段 | 责任人 | 预计时间 | 实际完成 |
|------|--------|---------|---------|
| 后端代码修改 | 后端团队 | 11月2日 | ✅ 已完成 |
| AI团队准备 | AI团队 | 待定 | ⏳ 进行中 |
| 联调测试 | 双方团队 | 3-5天 | ⏳ 待开始 |
| 生产部署 | 双方团队 | 1天 | ⏳ 待开始 |

---

## 🚨 阻塞问题

### 当前阻塞

1. **等待AI团队提供URL**
   - 影响: 无法开始测试
   - 优先级: 高
   - 负责人: AI团队

2. **格式规范确认**
   - 影响: 不确定实现是否正确
   - 优先级: 高
   - 负责人: AI团队

### 潜在风险

1. **首次请求超时**
   - 风险: Colab冷启动慢
   - 影响: 用户体验差
   - 缓解: 增加超时时间或预热

2. **解析失败率高**
   - 风险: 格式不稳定
   - 影响: 频繁降级
   - 缓解: 优化标记格式

3. **URL不稳定**
   - 风险: 频繁变化
   - 影响: 运维成本高
   - 缓解: 建立通知机制

---

## 📞 沟通计划

### 日常沟通

- **频率**: 每天一次
- **渠道**: 微信群/Slack/钉钉
- **内容**: 进展、问题、计划

### 关键里程碑会议

1. **格式确认会议**（马上）
   - 时间: 尽快
   - 内容: 确认API格式理解
   - 参与: 双方技术负责人

2. **联调启动会议**（AI准备完成后）
   - 时间: 1-2天后
   - 内容: 确定测试计划
   - 参与: 双方测试人员

3. **生产部署会议**（测试通过后）
   - 时间: 5-7天后
   - 内容: 部署计划
   - 参与: 双方技术+运维

---

## ✅ 验收标准

### 必须满足

- [ ] 所有测试用例通过
- [ ] 格式正确率 > 95%
- [ ] 响应时间可接受
- [ ] 无崩溃和死锁
- [ ] 降级方案正常
- [ ] 日志完整清晰

### 最好满足

- [ ] 格式正确率 = 100%
- [ ] 响应时间 < 3秒
- [ ] 降级率 < 5%
- [ ] 用户反馈积极

---

## 📝 备注

### 重要提醒

1. **格式规范是关键**: 必须严格按照`API要求文档.md`
2. **测试先行**: 先自测再联调
3. **及时沟通**: 遇到问题立即反馈
4. **文档更新**: 重要的理解变更需更新文档

### 联系方式

请查看`联系方式.md`获取详细联系方式。

---

**定期更新此清单，保持双方信息同步！**

