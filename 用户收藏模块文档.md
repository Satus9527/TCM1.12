# ç”¨æˆ·æ”¶è—æ¨¡å—æ–‡æ¡£

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

ç”¨æˆ·æ”¶è—æ¨¡å—å…è®¸ç”¨æˆ·æ”¶è—æ„Ÿå…´è¶£çš„æ–¹å‰‚ï¼Œå¹¶ä¸ºæ¯ä¸ªæ”¶è—æ·»åŠ ä¸ªäººå­¦ä¹ ç¬”è®°ã€‚

**å¼€å‘çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•

---

## ğŸ¯ åŠŸèƒ½åˆ—è¡¨

| åŠŸèƒ½ | APIç«¯ç‚¹ | æ–¹æ³• | æƒé™ | çŠ¶æ€ |
|------|---------|------|------|------|
| æ·»åŠ æ”¶è— | `/api/collections` | POST | éœ€ç™»å½• | âœ… |
| å–æ¶ˆæ”¶è— | `/api/collections/:formulaId` | DELETE | éœ€ç™»å½• | âœ… |
| æ›´æ–°å¤‡æ³¨ | `/api/collections/:formulaId` | PUT | éœ€ç™»å½• | âœ… |
| è·å–æ”¶è—åˆ—è¡¨ | `/api/collections` | GET | éœ€ç™»å½• | âœ… |
| æ£€æŸ¥æ”¶è—çŠ¶æ€ | `/api/collections/check/:formulaId` | GET | éœ€ç™»å½• | âœ… |
| è·å–æ”¶è—ç»Ÿè®¡ | `/api/collections/stats` | GET | éœ€ç™»å½• | âœ… |

---

## ğŸ“¡ API è¯¦ç»†è¯´æ˜

### 1. æ·»åŠ æ”¶è—

**è¯·æ±‚**:
```http
POST /api/collections
Authorization: Bearer <token>
Content-Type: application/json

{
  "formula_id": "æ–¹å‰‚UUID",
  "notes": "ä¸ªäººå­¦ä¹ ç¬”è®°ï¼ˆå¯é€‰ï¼‰"
}
```

**æˆåŠŸå“åº”** (201):
```json
{
  "success": true,
  "data": {
    "collection_id": "uuid...",
    "user_id": "uuid...",
    "formula_id": "uuid...",
    "notes": "ä¸ªäººå­¦ä¹ ç¬”è®°",
    "created_at": "2025-10-29T...",
    "formula": {
      "formula_id": "uuid...",
      "name": "å››ç‰©æ±¤",
      "pinyin": "siwutang",
      "category": "è¡¥ç›Šå‰‚",
      "efficacy": "è¡¥è¡€æ´»è¡€"
    }
  },
  "message": "æ”¶è—æˆåŠŸ"
}
```

**é”™è¯¯å“åº”**:
- `404`: æ–¹å‰‚ä¸å­˜åœ¨
- `409`: å·²æ”¶è—è¯¥æ–¹å‰‚

---

### 2. å–æ¶ˆæ”¶è—

**è¯·æ±‚**:
```http
DELETE /api/collections/:formulaId
Authorization: Bearer <token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "success": true,
  "message": "å–æ¶ˆæ”¶è—æˆåŠŸ"
}
```

**é”™è¯¯å“åº”**:
- `404`: æ”¶è—è®°å½•ä¸å­˜åœ¨

---

### 3. æ›´æ–°æ”¶è—å¤‡æ³¨

**è¯·æ±‚**:
```http
PUT /api/collections/:formulaId
Authorization: Bearer <token>
Content-Type: application/json

{
  "notes": "æ›´æ–°åçš„ç¬”è®°å†…å®¹"
}
```

**æˆåŠŸå“åº”** (200):
```json
{
  "success": true,
  "data": {
    "collection_id": "uuid...",
    "notes": "æ›´æ–°åçš„ç¬”è®°å†…å®¹",
    "formula": {...}
  },
  "message": "å¤‡æ³¨æ›´æ–°æˆåŠŸ"
}
```

---

### 4. è·å–æ”¶è—åˆ—è¡¨

**è¯·æ±‚**:
```http
GET /api/collections?page=1&limit=20&sortBy=created_at&sortOrder=DESC
Authorization: Bearer <token>
```

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤ 1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ 20ï¼‰
- `sortBy`: æ’åºå­—æ®µï¼ˆé»˜è®¤ created_atï¼‰
- `sortOrder`: æ’åºæ–¹å‘ï¼ˆASC/DESCï¼Œé»˜è®¤ DESCï¼‰

**æˆåŠŸå“åº”** (200):
```json
{
  "success": true,
  "data": {
    "collections": [
      {
        "collection_id": "uuid...",
        "user_id": "uuid...",
        "formula_id": "uuid...",
        "notes": "ç¬”è®°å†…å®¹",
        "created_at": "2025-10-29T...",
        "formula": {
          "formula_id": "uuid...",
          "name": "å››ç‰©æ±¤",
          "category": "è¡¥ç›Šå‰‚",
          "efficacy": "è¡¥è¡€æ´»è¡€"
        }
      }
    ],
    "pagination": {
      "total": 5,
      "page": 1,
      "limit": 20,
      "totalPages": 1
    }
  }
}
```

---

### 5. æ£€æŸ¥æ”¶è—çŠ¶æ€

**è¯·æ±‚**:
```http
GET /api/collections/check/:formulaId
Authorization: Bearer <token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "success": true,
  "data": {
    "is_collected": true
  }
}
```

---

### 6. è·å–æ”¶è—ç»Ÿè®¡

**è¯·æ±‚**:
```http
GET /api/collections/stats
Authorization: Bearer <token>
```

**æˆåŠŸå“åº”** (200):
```json
{
  "success": true,
  "data": {
    "total_collections": 5
  }
}
```

---

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ collectionService.js        # æ”¶è—ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ collectionController.js     # æ”¶è—è·¯ç”±å¤„ç†å™¨
â”œâ”€â”€ middlewares/
â”‚   â””â”€â”€ validators/
â”‚       â””â”€â”€ collectionValidator.js  # æ”¶è—è¾“å…¥éªŒè¯
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ collectionRoutes.js         # æ”¶è—è·¯ç”±å®šä¹‰
â””â”€â”€ models/
    â””â”€â”€ UserCollection.js            # æ”¶è—æ•°æ®æ¨¡å‹
```

---

## ğŸ§ª æµ‹è¯•ç»“æœ

**æµ‹è¯•æ—¶é—´**: 2025-10-29  
**æµ‹è¯•è´¦å·**: student_wang  

| æµ‹è¯•é¡¹ | çŠ¶æ€ |
|--------|------|
| ç”¨æˆ·ç™»å½• | âœ… |
| è·å–æ–¹å‰‚åˆ—è¡¨ | âœ… |
| æ·»åŠ æ”¶è— | âœ… |
| æ£€æŸ¥æ”¶è—çŠ¶æ€ | âœ… |
| è·å–æ”¶è—åˆ—è¡¨ | âœ… |
| æ›´æ–°æ”¶è—å¤‡æ³¨ | âœ… |
| è·å–æ”¶è—ç»Ÿè®¡ | âœ… |
| å–æ¶ˆæ”¶è— | âœ… |
| å†æ¬¡æ£€æŸ¥çŠ¶æ€ | âœ… |

**é€šè¿‡ç‡**: 9/9 (100%) âœ…

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### cURL ç¤ºä¾‹

#### æ·»åŠ æ”¶è—
```bash
curl -X POST http://localhost:3000/api/collections \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "formula_id": "a889aa9a-dbea-4d81-86de-112dc5eb5a98",
    "notes": "å››ç‰©æ±¤æ˜¯è¡¥è¡€çš„ç»å…¸æ–¹å‰‚"
  }'
```

#### è·å–æˆ‘çš„æ”¶è—
```bash
curl -X GET "http://localhost:3000/api/collections?page=1&limit=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### å–æ¶ˆæ”¶è—
```bash
curl -X DELETE http://localhost:3000/api/collections/a889aa9a-dbea-4d81-86de-112dc5eb5a98 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## ğŸ”’ æƒé™è¯´æ˜

- **æ‰€æœ‰æ”¶è—æ“ä½œéƒ½éœ€è¦ç”¨æˆ·ç™»å½•**
- ç”¨æˆ·åªèƒ½ç®¡ç†è‡ªå·±çš„æ”¶è—
- ä¸èƒ½æ”¶è—ä¸å­˜åœ¨çš„æ–¹å‰‚
- ä¸èƒ½é‡å¤æ”¶è—åŒä¸€ä¸ªæ–¹å‰‚

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### user_collections è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| collection_id | UUID | ä¸»é”® |
| user_id | UUID | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| formula_id | UUID | æ–¹å‰‚IDï¼ˆå¤–é”®ï¼‰ |
| notes | TEXT | ç”¨æˆ·å¤‡æ³¨ |
| created_at | DATETIME | åˆ›å»ºæ—¶é—´ |

**å”¯ä¸€çº¦æŸ**: (user_id, formula_id)  
**çº§è”åˆ é™¤**: ç”¨æˆ·æˆ–æ–¹å‰‚åˆ é™¤æ—¶ï¼Œæ”¶è—è®°å½•è‡ªåŠ¨åˆ é™¤

---

## âœ¨ ç‰¹æ€§

1. **é˜²é‡å¤æ”¶è—**: åŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤æ”¶è—åŒä¸€æ–¹å‰‚
2. **å…³è”æŸ¥è¯¢**: è¿”å›æ”¶è—æ—¶è‡ªåŠ¨åŒ…å«æ–¹å‰‚ä¿¡æ¯
3. **ä¸ªäººç¬”è®°**: æ”¯æŒä¸ºæ¯ä¸ªæ”¶è—æ·»åŠ å­¦ä¹ ç¬”è®°
4. **åˆ†é¡µæ”¯æŒ**: æ”¶è—åˆ—è¡¨æ”¯æŒåˆ†é¡µæŸ¥è¯¢
5. **å®æ—¶ç»Ÿè®¡**: è·å–ç”¨æˆ·æ”¶è—æ€»æ•°
6. **å¿«é€Ÿæ£€æŸ¥**: ä¸€é”®æ£€æŸ¥æŸæ–¹å‰‚æ˜¯å¦å·²æ”¶è—

---

**è¿è¡Œæµ‹è¯•**: `node test-collections.js`

