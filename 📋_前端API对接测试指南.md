# 📋 前端 API 对接测试指南

**测试日期**: 2025-11-05  
**测试目标**: 验证前端 API 对接配置是否正常工作

---

## 🚀 快速测试步骤

### 1. 启动服务

确保以下服务都已启动：

```bash
# 后端服务 (端口 3000)
# 应该已经在运行

# 前端服务 (端口 5173)
cd czb
npm run dev
```

### 2. 浏览器测试

1. **打开浏览器**: 访问 http://localhost:5173
2. **打开开发者工具**: 按 `F12` 或右键 → "检查"
3. **切换到 Console 标签**: 查看是否有错误信息
4. **切换到 Network 标签**: 查看 API 请求

---

## ✅ 功能测试清单

### 1. 用户登录测试

**测试步骤**:
1. 访问登录页面
2. 输入用户名和密码
3. 点击登录

**预期结果**:
- ✅ 登录成功，跳转到首页
- ✅ Network 标签中看到 `POST /api/auth/login` 请求
- ✅ 请求状态码为 `200`
- ✅ 响应中包含 `access_token` 和 `user` 信息

**如果失败**:
- ❌ 检查后端服务是否运行
- ❌ 检查 Console 是否有错误信息
- ❌ 检查 Network 请求的响应内容

---

### 2. 药材搜索测试

**测试步骤**:
1. 登录后，进入"中医药知识库"页面
2. 查看药材列表
3. 尝试搜索药材（如"五味子"）
4. 点击某个药材卡片查看详情

**预期结果**:
- ✅ 药材列表正常显示（应该显示56个药材）
- ✅ Network 标签中看到 `GET /api/medicines?page=1&limit=12` 请求
- ✅ 请求状态码为 `200`
- ✅ 响应中包含药材数据（`medicine_id`, `name`, `category` 等）
- ✅ 点击药材详情后，弹窗正常显示药材信息
- ✅ Network 标签中看到 `GET /api/medicines/:id` 请求

**降级到虚拟数据的标志**:
- ⚠️ Console 中看到 "搜索药材失败，使用模拟数据" 或 "获取药材详情失败，使用模拟数据"
- ⚠️ 响应数据中包含 `isMock: true`
- ⚠️ 药材数量只有约20个（而不是56个）

---

### 3. 药材分类测试

**测试步骤**:
1. 进入"中医药知识库"页面
2. 查看左侧"知识分类"列表

**预期结果**:
- ✅ 分类列表正常显示（如"全部药材"、"清热药"、"解表药"等）
- ✅ 每个分类显示药材数量
- ✅ Network 标签中看到 `GET /api/medicine-categories` 请求
- ✅ 请求状态码为 `200`
- ✅ 分类名称**不包含**"（模拟）"标注

**降级到虚拟数据的标志**:
- ⚠️ Console 中看到 "获取分类失败，使用模拟数据"
- ⚠️ 分类名称包含"（模拟）"标注
- ⚠️ 响应数据中包含 `isMock: true`

---

### 4. 收藏功能测试

**测试步骤**:
1. 在药材详情页面，点击收藏按钮
2. 进入"个人中心" → "收藏"标签

**预期结果**:
- ✅ 收藏操作成功
- ✅ Network 标签中看到 `POST /api/collections` 或 `POST /api/content/collections` 请求
- ✅ 请求状态码为 `200`
- ✅ 收藏列表正常显示

**降级到虚拟数据的标志**:
- ⚠️ Console 中看到 "收藏操作失败，使用模拟数据" 或 "添加收藏失败，使用模拟数据"
- ⚠️ 响应数据中包含 `isMock: true`

---

### 5. 处方管理测试

**测试步骤**:
1. 进入"配伍模拟室"页面
2. 添加一些药材到配伍列表
3. 点击"保存方案"
4. 查看"我的处方"列表

**预期结果**:
- ✅ 配伍分析正常显示
- ✅ 保存处方成功
- ✅ Network 标签中看到 `POST /api/content/simulations/save` 请求
- ✅ 请求状态码为 `200`
- ✅ 处方列表正常显示

**降级到虚拟数据的标志**:
- ⚠️ Console 中看到 "保存处方失败，使用模拟数据" 或 "获取处方列表失败，使用模拟数据"
- ⚠️ 响应数据中包含 `isMock: true`

---

## 🔍 控制台检查

### 正常情况

打开浏览器 Console，应该看到：
- ✅ 没有红色错误信息
- ✅ 只有正常的日志信息（如"登录成功"）

### 降级到虚拟数据的标志

如果看到以下信息，说明接口降级到了虚拟数据：

```
⚠️ 搜索药材失败，使用模拟数据: ...
⚠️ 获取药材详情失败，使用模拟数据: ...
⚠️ 获取分类失败，使用模拟数据: ...
⚠️ 保存处方失败，使用模拟数据: ...
⚠️ 获取收藏列表失败，使用模拟数据: ...
```

**注意**: 这些是**警告信息**，不是错误。系统会自动降级到虚拟数据，确保功能可用。

---

## 📊 Network 请求检查

### 检查真实 API 请求

在 Network 标签中，应该看到以下请求：

| 功能 | 请求路径 | 状态码 | 说明 |
|------|---------|--------|------|
| 登录 | `POST /api/auth/login` | 200 | ✅ 真实API |
| 药材搜索 | `GET /api/medicines?page=1&limit=12` | 200 | ✅ 真实API |
| 药材详情 | `GET /api/medicines/:id` | 200 | ✅ 真实API |
| 药材分类 | `GET /api/medicine-categories` | 200 | ✅ 真实API |
| 收藏 | `POST /api/collections` | 200 | ✅ 真实API |
| 保存处方 | `POST /api/content/simulations/save` | 200 | ✅ 真实API |

### 检查响应数据

点击 Network 中的请求，查看 Response 标签：

**真实数据示例**:
```json
{
  "success": true,
  "data": {
    "medicines": [
      {
        "medicine_id": "3571a734-1a20-45c2-9de8-8528a1a71613",
        "name": "五味子",
        "category": "收涩药",
        ...
      }
    ],
    "pagination": {
      "total": 56,
      ...
    }
  }
}
```

**虚拟数据示例**:
```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "name": "人参",
        ...
      }
    ],
    "total": 20,
    "isMock": true
  }
}
```

**关键区别**:
- ✅ 真实数据：`medicine_id` 是 UUID，`total` 是 56
- ❌ 虚拟数据：`id` 是数字，`total` 约 20，有 `isMock: true`

---

## 🐛 常见问题排查

### 问题1: 前端服务无法启动

**症状**: `npm run dev` 报错

**解决方案**:
```bash
cd czb
npm install  # 重新安装依赖
npm run dev
```

---

### 问题2: API 请求返回 404

**症状**: Network 标签中看到 `404 Not Found`

**可能原因**:
1. 后端服务未启动
2. API 路径错误

**解决方案**:
1. 检查后端服务是否运行: `curl http://localhost:3000/api/health`
2. 检查 API 路径是否正确（不应包含重复的 `/api`）

---

### 问题3: API 请求返回 401

**症状**: Network 标签中看到 `401 Unauthorized`

**可能原因**:
1. Token 过期
2. Token 未正确传递

**解决方案**:
1. 重新登录获取新的 token
2. 检查 `localStorage.getItem('access_token')` 是否有值

---

### 问题4: 所有数据都显示为虚拟数据

**症状**: 所有数据都包含 `isMock: true`

**可能原因**:
1. 后端服务未启动
2. 后端 API 路径不匹配
3. CORS 问题

**解决方案**:
1. 检查后端服务: `curl http://localhost:3000/api/health`
2. 检查后端日志，查看是否有错误
3. 检查浏览器 Console，查看具体错误信息

---

## ✅ 测试通过标准

### 必须通过

- [x] 用户登录功能正常
- [x] 药材列表正常显示（56个药材）
- [x] 药材详情正常显示
- [x] 药材分类正常显示（不包含"（模拟）"标注）

### 建议通过

- [ ] 收藏功能正常
- [ ] 处方保存功能正常
- [ ] 处方列表正常显示

---

## 📝 测试结果记录

测试完成后，请记录以下信息：

1. **测试时间**: _______________
2. **测试人员**: _______________
3. **后端服务状态**: ✅ 正常 / ❌ 异常
4. **前端服务状态**: ✅ 正常 / ❌ 异常
5. **真实数据使用情况**:
   - 药材搜索: ✅ 真实数据 / ❌ 虚拟数据
   - 药材详情: ✅ 真实数据 / ❌ 虚拟数据
   - 药材分类: ✅ 真实数据 / ❌ 虚拟数据
   - 收藏功能: ✅ 真实数据 / ❌ 虚拟数据
   - 处方功能: ✅ 真实数据 / ❌ 虚拟数据
6. **发现的问题**: _______________
7. **备注**: _______________

---

**测试完成后，请告诉我测试结果！** 🎯

