# 📖 如何使用完整自测指南

**文档**: 完整自测指南.md  
**目的**: 指导如何执行完整的项目自测试  

---

## 🎯 自测指南概述

我为您创建了一个详细的**78项自测指南**，覆盖项目的所有功能模块。

### 📋 测试覆盖

| 模块 | 测试数 | 难度 | 预计时间 |
|------|--------|------|----------|
| 基础配置 | 6项 | ⭐ | 5分钟 |
| 数据库 | 5项 | ⭐⭐ | 10分钟 |
| 认证授权 | 10项 | ⭐⭐ | 15分钟 |
| 知识库 | 12项 | ⭐⭐ | 20分钟 |
| AI推荐 | 8项 | ⭐⭐⭐ | 15分钟 |
| WebSocket | 10项 | ⭐⭐⭐ | 20分钟 |
| 个性化内容 | 12项 | ⭐⭐ | 20分钟 |
| 文件管理 | 10项 | ⭐⭐ | 15分钟 |
| 综合测试 | 5项 | ⭐⭐ | 10分钟 |
| **总计** | **78项** | | **2小时** |

---

## 🚀 三种测试方式

### 方式1: 快速自动化测试 ⭐⭐⭐ (推荐)

**最简单，最快**

#### 使用现有测试脚本

```bash
# 在项目目录下
cd "D:\TCM web"

# 运行全局测试
node test-global-simple.js
```

**优点**:
- ✅ 自动化执行
- ✅ 快速完成
- ✅ 提供统计报告
- ✅ 无需手动操作

**预期时间**: 约5-10分钟

---

### 方式2: 按模块手动测试 ⭐⭐

**按需测试，了解详情**

#### 步骤1: 选择测试模块

根据需求选择测试模块：

```bash
# 测试认证
node test-auth-middleware.js

# 测试知识库
node test-knowledge-api.js

# 测试AI推荐
node test-recommendation-api.js

# 测试WebSocket
node test-websocket.js

# 测试个性化内容
node test-content-api.js

# 测试文件上传
node test-file-upload.js
```

#### 步骤2: 记录结果

将结果记录到自测指南的表格中。

**预期时间**: 每模块10-30分钟

---

### 方式3: 完整详细测试 ⭐

**最全面，最耗时**

#### 按照完整自测指南逐项执行

1. 打开 `完整自测指南.md`
2. 按照顺序执行每一项测试
3. 记录每个测试的结果
4. 完成后统计通过率

**优点**:
- ✅ 最全面覆盖
- ✅ 深入了解每个细节
- ✅ 识别所有潜在问题

**缺点**:
- ⏱️ 耗时较长（约2小时）
- 📝 需要手动记录

**预期时间**: 约2小时

---

## 📝 测试流程建议

### 快速验证流程 (15分钟)

**适合**: 确认项目基本可用

```bash
# 1. 启动服务器
npm run dev

# 在新终端运行
# 2. 健康检查
curl http://localhost:3000/api/health

# 3. 自动化测试
node test-global-simple.js

# 4. 查看结果
# 检查通过率是否>80%
```

### 标准测试流程 (30分钟)

**适合**: 常规质量检查

```bash
# 1. 基础检查（5分钟）
node test-auth-middleware.js
node test-knowledge-api.js

# 2. 功能测试（20分钟）
node test-content-api.js
node test-recommendation-api.js

# 3. 高级功能（5分钟）
node test-websocket.js
```

### 完整测试流程 (2小时)

**适合**: 发布前的全面检查

1. ✅ 执行所有自动化测试
2. ✅ 按照完整自测指南逐项检查
3. ✅ 记录所有问题
4. ✅ 生成测试报告
5. ✅ 修复发现的问题

---

## 🛠️ 工具准备

### 必备工具

- ✅ **Node.js**: 用于运行测试脚本
- ✅ **MySQL**: 数据库服务
- ✅ **Redis**: 缓存服务（可选）
- ✅ **curl**: HTTP请求测试

### 可选工具

- ⚙️ **Postman**: GUI测试工具
- ⚙️ **WebSocket客户端**: WebSocket测试
- ⚙️ **Apache Bench**: 压力测试
- ⚙️ **jq**: JSON解析工具

### 安装测试工具

```bash
# Windows (chocolatey)
choco install curl jq

# Linux
sudo apt-get install curl jq

# Mac
brew install curl jq
```

---

## 📊 结果解读

### 通过标准

#### 基础测试
- **通过率**: ≥100%
- **所有测试**: 必须全部通过

#### 功能测试
- **通过率**: ≥80%
- **核心功能**: 必须通过
- **扩展功能**: 允许部分失败

#### 综合测试
- **通过率**: ≥70%
- **稳定性**: 重点关注

---

### 结果等级

| 通过率 | 等级 | 说明 | 建议 |
|--------|------|------|------|
| 95-100% | ✅ 优秀 | 质量很高 | 可以部署 |
| 80-94% | ✅ 良好 | 基本满意 | 建议修复关键问题 |
| 60-79% | ⚠️ 一般 | 存在问题 | 必须修复再部署 |
| <60% | ❌ 差 | 严重问题 | 不建议使用 |

---

## 🎯 测试重点

### 🔴 必须通过（阻塞部署）

1. ✅ 服务器启动
2. ✅ 数据库连接
3. ✅ 健康检查
4. ✅ 用户登录
5. ✅ Token验证
6. ✅ 权限控制

### 🟡 建议通过（影响体验）

1. ✅ 药材/方剂查询
2. ✅ 收藏管理
3. ✅ 模拟方案
4. ✅ 文件上传
5. ✅ 错误处理

### 🟢 可选通过（锦上添花）

1. ⚠️ AI推荐
2. ⚠️ WebSocket
3. ⚠️ 高级缓存
4. ⚠️ 性能优化

---

## 📝 记录模板

### 测试记录表

```
日期: ___________
测试人: ___________
版本: v1.0.0
环境: Development

模块测试结果:
┌─────────────────────┬─────┬─────┬─────┐
│ 模块               │ 总数│ 通过│ 失败│
├─────────────────────┼─────┼─────┼─────┤
│ 基础配置           │  6  │ ___ │ ___ │
│ 数据库             │  5  │ ___ │ ___ │
│ 认证授权           │ 10  │ ___ │ ___ │
│ 知识库             │ 12  │ ___ │ ___ │
│ AI推荐             │  8  │ ___ │ ___ │
│ WebSocket          │ 10  │ ___ │ ___ │
│ 个性化内容         │ 12  │ ___ │ ___ │
│ 文件管理           │ 10  │ ___ │ ___ │
│ 综合测试           │  5  │ ___ │ ___ │
├─────────────────────┼─────┼─────┼─────┤
│ 总计               │ 78  │ ___ │ ___ │
└─────────────────────┴─────┴─────┴─────┘

通过率: _____%

发现的问题:
1. 
2. 
3. 

改进建议:
1. 
2. 
3. 

测试结论:
□ 通过 - 可以部署
□ 有条件通过 - 需修复关键问题
□ 不通过 - 需要进一步修复

签名: ___________
```

---

## 🚨 常见问题

### 问题1: 测试脚本执行失败

**症状**: `Error: Cannot find module`

**解决**:
```bash
# 检查是否在正确目录
pwd
# 应该显示: D:\TCM web

# 安装依赖
npm install
```

### 问题2: 数据库连接失败

**症状**: `ECONNREFUSED` 或 `ER_ACCESS_DENIED_ERROR`

**解决**:
```bash
# 检查MySQL服务
sc query MySQL

# 启动MySQL
Start-Service MySQL

# 检查.env配置
Get-Content .env | Select-String "DB_PASSWORD"
```

### 问题3: 端口被占用

**症状**: `EADDRINUSE: address already in use :::3000`

**解决**:
```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID <PID> /F

# 或修改端口
# 编辑 .env 文件
PORT=3001
```

### 问题4: Redis连接失败

**症状**: 缓存功能报错

**解决**:
```bash
# 检查Redis服务
redis-cli ping
# 预期: PONG

# 如未安装，测试仍可进行（缓存会降级）
```

---

## 📚 参考文档

### 核心文档

- **完整自测指南.md** - 详细测试步骤
- **test-global-simple.js** - 自动化测试脚本
- **项目补全工作总结.md** - 项目状态
- **阶段二完成总结.md** - 功能清单

### 功能文档

- **个性化内容API快速参考.md** - 收藏和模拟方案
- **知识库API快速参考.md** - 药材和方剂
- **文件上传API快速参考.md** - 文件管理
- **MinIO部署指南.md** - 对象存储

### API测试

- **test-auth-middleware.js** - 认证测试
- **test-knowledge-api.js** - 知识库测试
- **test-content-api.js** - 内容测试
- **test-websocket.js** - WebSocket测试

---

## ✅ 测试清单

### 开始前检查

- [ ] 服务器正在运行
- [ ] 数据库连接正常
- [ ] .env 文件配置正确
- [ ] 测试工具已安装
- [ ] 测试文档已打开

### 测试中记录

- [ ] 记录每个测试的结果
- [ ] 截图保存错误信息
- [ ] 标记失败的测试
- [ ] 记录发现的bug

### 测试后总结

- [ ] 统计通过率
- [ ] 列出发现的问题
- [ ] 给出改进建议
- [ ] 生成测试报告

---

## 🎯 快速开始

### 立即开始测试

```bash
# 1. 确保服务器运行
# 在第一个终端
npm run dev

# 2. 在新终端运行自动化测试
cd "D:\TCM web"
node test-global-simple.js

# 3. 查看结果
# 通过率应该 > 80%
```

### 如需帮助

1. 查看 `完整自测指南.md` 的详细步骤
2. 检查 `PROJECT_STATUS.md` 了解项目状态
3. 阅读 `遗留问题清单.md` 了解已知问题
4. 参考测试脚本中的注释

---

**祝您测试顺利！** 🚀

**自测指南创建时间**: 2025年1月  
**建议测试频率**: 每个版本发布前

