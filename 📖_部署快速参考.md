# ğŸ“– TCM Platform éƒ¨ç½²å¿«é€Ÿå‚è€ƒ

## ğŸ¯ æ ¸å¿ƒå‘½ä»¤é€ŸæŸ¥è¡¨

### æœåŠ¡å™¨å‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
sudo apt update && sudo apt install -y nginx mysql-server redis-server git python3-certbot-nginx

# å®‰è£… Node.js (é€šè¿‡ nvm)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
nvm install --lts
nvm use --lts

# å®‰è£… PM2
npm install -g pm2
pm2 install pm2-logrotate
```

### æ•°æ®åº“é…ç½®

```bash
# MySQL å®‰å…¨è®¾ç½®
sudo mysql_secure_installation

# åˆ›å»ºæ•°æ®åº“
sudo mysql -u root -p
CREATE DATABASE tcm_platform CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'tcm_app_user'@'localhost' IDENTIFIED BY 'YOUR_PASSWORD';
GRANT ALL PRIVILEGES ON tcm_platform.* TO 'tcm_app_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### é˜²ç«å¢™é…ç½®

```bash
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh http https
sudo ufw enable
sudo ufw status
```

### éƒ¨ç½²ä»£ç 

```bash
# å…‹éš†ä»£ç 
cd /var/www
sudo git clone YOUR_REPO_URL tcm-backend
cd tcm-backend
nvm use

# å®‰è£…ä¾èµ–
npm install --production

# æ•°æ®åº“è¿ç§»
npm run db:migrate
npm run db:seed
```

### é…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»º .env æ–‡ä»¶
sudo nano /var/www/tcm-backend/.env

# è®¾ç½®æƒé™
sudo chmod 600 /var/www/tcm-backend/.env
```

### Nginx é…ç½®

```bash
# åˆ›å»ºé…ç½®
sudo nano /etc/nginx/sites-available/tcm_platform

# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/tcm_platform /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# SSL è¯ä¹¦
sudo certbot --nginx -d yourdomain.com
```

### PM2 å¯åŠ¨

```bash
# åˆ›å»ºå¯åŠ¨è„šæœ¬
sudo nano /usr/local/bin/start_tcm.sh
sudo chmod +x /usr/local/bin/start_tcm.sh

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save

# å¯åŠ¨æœåŠ¡
sudo /usr/local/bin/start_tcm.sh
```

---

## ğŸ” å¸¸ç”¨æ£€æŸ¥å‘½ä»¤

### æœåŠ¡çŠ¶æ€

```bash
# PM2 çŠ¶æ€
pm2 status
pm2 logs tcm-backend
pm2 monit

# ç³»ç»ŸæœåŠ¡
sudo systemctl status mysql
sudo systemctl status redis-server
sudo systemctl status nginx

# é˜²ç«å¢™
sudo ufw status
```

### å¥åº·æ£€æŸ¥

```bash
# åç«¯å¥åº·
curl http://localhost:3000/api/health

# é€šè¿‡åŸŸå
curl https://yourdomain.com/api/health
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# PM2 æ—¥å¿—
pm2 logs tcm-backend

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/tcm_platform_access.log
sudo tail -f /var/log/nginx/tcm_platform_error.log

# åº”ç”¨æ—¥å¿—
tail -f /var/www/tcm-backend/logs/combined.log
```

---

## ğŸ”§ æ•…éšœæ’é™¤

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| Node.js ç‰ˆæœ¬ä¸å¯¹ | `nvm use` æˆ– `nvm use lts/hydrogen` |
| æ•°æ®åº“è¿æ¥å¤±è´¥ | æ£€æŸ¥ `.env` ä¸­çš„ `DB_*` é…ç½® |
| Redis è¿æ¥å¤±è´¥ | `sudo systemctl start redis-server` |
| PM2 æ— æ³•å¯åŠ¨ | `pm2 logs tcm-backend --err` æŸ¥çœ‹é”™è¯¯ |
| Nginx 502 | æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œï¼š`pm2 status` |
| SSL è¯ä¹¦é—®é¢˜ | `sudo certbot renew --dry-run` |

---

## ğŸ“¦ æ›´æ–°éƒ¨ç½²

### æ–¹æ³•1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬

```bash
cd /var/www/tcm-backend
./deploy.sh
```

### æ–¹æ³•2: æ‰‹åŠ¨æ›´æ–°

```bash
cd /var/www/tcm-backend
git pull
npm install --production
pm2 restart tcm-backend
```

---

## ğŸ” å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] MySQL root å¯†ç å·²è®¾ç½®
- [ ] åº”ç”¨æ•°æ®åº“ç”¨æˆ·æƒé™æœ€å°åŒ–
- [ ] é˜²ç«å¢™å·²å¯ç”¨å¹¶é…ç½®
- [ ] `.env` æ–‡ä»¶æƒé™ä¸º `600`
- [ ] `JWT_SECRET` å·²ç”Ÿæˆéšæœºå­—ç¬¦ä¸²
- [ ] SSL è¯ä¹¦å·²é…ç½®
- [ ] æ•°æ®åº“å¯†ç è¶³å¤Ÿå¼º
- [ ] Redis æœªå¯¹å¤–å¼€æ”¾
- [ ] SSH å¯†é’¥è®¤è¯å·²é…ç½®ï¼ˆå¯é€‰ï¼‰

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

```bash
# PM2 ç›‘æ§é¢æ¿
pm2 monit

# ç³»ç»Ÿèµ„æº
top
htop

# ç£ç›˜ä½¿ç”¨
df -h

# å†…å­˜ä½¿ç”¨
free -h

# ç½‘ç»œè¿æ¥
sudo netstat -tlnp
```

---

## ğŸ’¾ å¤‡ä»½å‘½ä»¤

### æ•°æ®åº“å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u tcm_app_user -p tcm_platform > backup_$(date +%Y%m%d).sql

# å®šæ—¶å¤‡ä»½ï¼ˆæ·»åŠ åˆ° crontabï¼‰
0 2 * * * mysqldump -u tcm_app_user -pPASSWORD tcm_platform > /var/backups/tcm_$(date +\%Y\%m\%d).sql
```

### ä»£ç å¤‡ä»½

```bash
# ä½¿ç”¨ Git åˆ›å»ºæ ‡ç­¾
cd /var/www/tcm-backend
git tag -a v1.0.0-$(date +%Y%m%d) -m "Backup before update"
git push origin --tags
```

---

## ğŸ”— å‚è€ƒé“¾æ¥

- å®Œæ•´éƒ¨ç½²æŒ‡å—: `ğŸš€_ç”Ÿäº§éƒ¨ç½²æŒ‡å—_æ— Dockerç‰ˆ.md`
- é¡¹ç›®æ–‡æ¡£: `README.md`
- æµ‹è¯•æŒ‡å—: `å®Œæ•´è‡ªæµ‹æŒ‡å—.md`
- PM2 æ–‡æ¡£: https://pm2.keymetrics.io/
- Nginx æ–‡æ¡£: https://nginx.org/en/docs/

---

**å¿«é€Ÿæç¤º**: é‡åˆ°é—®é¢˜æ—¶ï¼Œå…ˆæŸ¥çœ‹æ—¥å¿—ï¼å¤§å¤šæ•°é—®é¢˜éƒ½å¯ä»¥é€šè¿‡æ—¥å¿—è¯Šæ–­ã€‚

