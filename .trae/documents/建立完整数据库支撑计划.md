## 数据库数据拓展计划（基于现有数据集）

### 1. 现有数据集分析

**已有的JSON数据集：**
- `18反19畏.json` - 25条中药配伍禁忌数据
- `四相.json` - 20条中药配伍关系数据（相须、相使、相畏、相杀）
- `中药的功效和性味.json` - 55种中药的功效和性味数据
- `药方数据集.json` - 15个经典方剂的详细数据

**现有数据库表：**
- `medicines` - 药材表（结构完整，缺少数据）
- `formulas` - 方剂表（结构完整，缺少数据）
- `formula_compositions` - 方剂组成表（结构完整，缺少数据）
- `users` - 用户表（结构完整，缺少数据）
- `user_collections` - 用户收藏表
- `user_simulations` - 用户模拟方案表
- `user_files` - 用户文件表
- `refresh_tokens` - 刷新令牌表

### 2. 数据需求分析

#### 2.1 现有数据集可直接导入的表
- **`medicines`** - 从 `中药的功效和性味.json` 导入
- **`formulas`** - 从 `药方数据集.json` 导入
- **`formula_compositions`** - 从 `药方数据集.json` 导入方剂组成数据

#### 2.2 需要创建的新表
- **`herb_interactions`** - 存储 `18反19畏.json` 中的配伍禁忌数据
- **`four_properties_relationships`** - 存储 `四相.json` 中的配伍关系数据
- **`medicine_categories`** - 药材分类表（用于前端分类筛选）

#### 2.3 需要补充的数据
- **药材分类数据** - 用于前端分类筛选
- **用户基础数据** - 用于登录、注册、用户信息管理

### 3. 数据迁移与填充计划

#### 3.1 阶段一：创建缺失的数据库表
1. **`herb_interactions`** - 中药配伍禁忌表
2. **`four_properties_relationships`** - 中药四相关系表
3. **`medicine_categories`** - 药材分类表

#### 3.2 阶段二：现有数据集导入
1. **`medicines`** 表导入
   - 从 `中药的功效和性味.json` 导入55种中药数据
   - 提取每个药材的名称、性味、归经、功效、主治等字段

2. **`formulas`** 表导入
   - 从 `药方数据集.json` 导入15个经典方剂
   - 提取方剂名称、出处、功效、主治等字段

3. **`formula_compositions`** 表导入
   - 从 `药方数据集.json` 导入方剂组成数据
   - 建立方剂与药材的关联关系，包含具体剂量

4. **`herb_interactions`** 表导入
   - 从 `18反19畏.json` 导入25条配伍禁忌数据
   - 包含十八反、十九畏的详细信息

5. **`four_properties_relationships`** 表导入
   - 从 `四相.json` 导入20条配伍关系数据
   - 包含相须、相使、相畏、相杀四种关系

6. **`medicine_categories`** 表导入
   - 基于现有药材数据，提取并创建药材分类

#### 3.3 阶段三：前端API改造
1. 修改前端API调用，从使用模拟数据改为调用真实后端API
2. 测试所有API接口的连通性和数据正确性
3. 优化前端数据展示，适应真实数据结构

### 4. 数据模型设计

#### 4.1 `herb_interactions` 表
```javascript
{
  interaction_id: UUID,
  type: STRING, // '十八反' 或 '十九畏'
  group: STRING, // 分组，如 '甘草反'
  herb_a: STRING, // 药材A名称
  herb_b: STRING, // 药材B名称
  description: TEXT, // 禁忌描述
  created_at: DATETIME,
  updated_at: DATETIME
}
```

#### 4.2 `four_properties_relationships` 表
```javascript
{
  relationship_id: UUID,
  type: STRING, // '相须'、'相使'、'相畏'、'相杀'
  herb_a: STRING, // 药材A名称
  herb_b: STRING, // 药材B名称
  description: TEXT, // 关系描述
  effect: STRING, // 效果
  example_prescription: STRING, // 例方
  mechanism: TEXT, // 作用机制
  created_at: DATETIME,
  updated_at: DATETIME
}
```

#### 4.3 `medicine_categories` 表
```javascript
{
  category_id: UUID,
  name: STRING, // 分类名称
  description: TEXT, // 分类描述
  icon: STRING, // 分类图标
  created_at: DATETIME,
  updated_at: DATETIME
}
```

### 5. 实施步骤

1. **创建缺失的数据库表**
2. **编写数据迁移脚本**
3. **导入现有JSON数据集**
4. **创建药材分类数据**
5. **导入方剂和方剂组成数据**
6. **导入配伍禁忌和四相关系数据**
7. **改造前端API调用**
8. **测试并验证数据完整性**

### 6. 预期效果

- 前端所有数据均来自真实数据库
- 实现完整的中医药数据分析功能
- 支持用户个性化操作（收藏、模拟等）
- 提供准确的配伍分析和禁忌提示
- 支持AI智能咨询功能

### 7. 缺失数据说明

**需要补充的数据：**
1. **更多的药材数据** - 现有仅55种，需要扩展到常用的200-300种
2. **更多的方剂数据** - 现有仅15个，需要扩展到经典方剂
3. **用户基础数据** - 用于测试登录、注册功能
4. **药材图片数据** - 用于前端展示
5. **详细的药材分类数据** - 用于更精确的分类筛选

### 8. 技术要点

- 使用Sequelize进行数据库操作
- 编写高效的数据迁移脚本
- 实现完整的API接口
- 确保数据的准确性和完整性
- 优化数据库查询性能

通过以上计划，可以基于现有数据集，快速实现从虚拟数据到真实数据库数据的转换，为前端提供完整的数据支持。