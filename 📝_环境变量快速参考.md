# 📝 环境变量快速参考

**更新日期**: 2025年11月3日

---

## 🎯 两个项目的环境变量

项目分为**前端**和**后端**两个独立的项目，需要分别配置环境变量。

---

## 🔴 后端环境变量

**位置**: `D:\TCM web\.env`  
**用途**: 后端服务器配置

### 当前配置 ✅

```env
NODE_ENV=development
PORT=3000

# 数据库
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=159357
DB_NAME=tcm_platform

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# JWT
JWT_SECRET=903babab31220b05c90b3e88db70e2da7a1aea311b4a49cf2bf3ec9f1f48ba48
JWT_ACCESS_EXPIRATION=15m
JWT_REFRESH_EXPIRATION=7d

# AI服务（Colab临时URL）
E1_RECOMMEND_URL=https://subsocial-robbyn-uninfinitely.ngrok-free.dev/consult
E1_ANALYZE_URL=https://subsocial-robbyn-uninfinitely.ngrok-free.dev/consult
E1_HEALTH_URL=https://subsocial-robbyn-uninfinitely.ngrok-free.dev/health
E1_TIMEOUT_MS=15000

# 日志
LOG_LEVEL=info

# 前端地址
FRONTEND_URL=http://localhost:8080
```

### 如何修改

**方法1: 用记事本**
```bash
notepad .env
```

**方法2: 用编辑器**
- VS Code: 打开 `D:\TCM web\.env`
- 修改后保存

**方法3: PowerShell**
```powershell
# 查看
type .env

# 修改（使用记事本）
notepad .env
```

---

## 🟢 前端环境变量

**位置**: `D:\TCM web\czb_test4\.env.development`  
**用途**: 前端开发环境配置

### 当前配置 ✅

```env
VITE_API_BASE_URL=http://localhost:3000/api
```

### 如何修改

**方法1: 用记事本**
```bash
cd czb_test4
notepad .env.development
```

**方法2: 用编辑器**
- VS Code: 打开 `D:\TCM web\czb_test4\.env.development`
- 修改后保存

**方法3: PowerShell（已创建）** ✅

```powershell
cd czb_test4
echo VITE_API_BASE_URL=http://localhost:3000/api > .env.development
```

---

## 🎨 前端环境变量说明

### .env.development (开发环境)

**用于**: `npm run dev`

```env
VITE_API_BASE_URL=http://localhost:3000/api
```

---

### .env.production (生产环境)

**用于**: `npm run build`

```env
VITE_API_BASE_URL=https://yourdomain.com/api
```

---

### 注意事项 ⚠️

1. **Vite 环境变量必须以 `VITE_` 开头**
   - ✅ 正确: `VITE_API_BASE_URL`
   - ❌ 错误: `API_BASE_URL`

2. **使用方式**
   ```javascript
   // 在代码中使用
   import.meta.env.VITE_API_BASE_URL
   ```

3. **修改后需要重启**
   - 修改 `.env` 文件后
   - 需要重启 `npm run dev`

---

## 🔄 常见修改场景

### 场景1: 修改后端端口

**后端** `.env`:
```env
PORT=3001  # 改为3001
```

**前端** `.env.development`:
```env
VITE_API_BASE_URL=http://localhost:3001/api  # 对应修改
```

---

### 场景2: 使用其他后端地址

**前端** `.env.development`:
```env
# 开发环境使用本地
VITE_API_BASE_URL=http://localhost:3000/api

# 或者使用远程测试服务器
VITE_API_BASE_URL=http://test.example.com/api
```

---

### 场景3: 部署到生产环境

**后端** `.env` (生产服务器):
```env
NODE_ENV=production
PORT=3000
DB_HOST=your-db-host
DB_PASSWORD=your-production-password
# ... 其他配置
```

**前端** `.env.production`:
```env
VITE_API_BASE_URL=https://api.yourdomain.com/api
```

---

## 📝 快速检查清单

### 后端环境变量 ✅

- [x] `.env` 文件存在
- [x] 数据库配置正确
- [x] Redis配置正确
- [x] JWT_SECRET已设置
- [x] AI服务URL已配置

---

### 前端环境变量 ✅

- [x] `.env.development` 已创建
- [x] `VITE_API_BASE_URL` 配置正确
- [x] `.env.production` 已创建（可选）

---

## 🚀 验证配置

### 后端验证

```bash
# 启动后端
cd "D:\TCM web"
启动服务器.bat

# 检查日志，应该看到
# Express 服务器在端口 3000 上运行
```

---

### 前端验证

```bash
# 启动前端
cd czb_test4
npm run dev

# 检查网络请求
# 打开浏览器开发者工具
# 查看Network标签
# API请求应该发送到 http://localhost:3000/api
```

---

## 🔍 排查问题

### 前端无法连接到后端

**检查**:
1. 后端是否启动 ✅
2. `.env.development` 是否存在 ✅
3. `VITE_API_BASE_URL` 是否正确 ✅
4. 前端是否重启 ✅

---

### 修改环境变量后无效

**原因**: 需要重启服务

**解决**:
1. 停止前端服务器 (Ctrl+C)
2. 重新运行 `npm run dev`
3. 刷新浏览器

---

## 📚 参考文档

- Vite环境变量: https://vite.dev/guide/env-and-mode.html
- 后端`.env`说明: 见`🔧_Colab环境配置模板.env`

---

## ✨ 总结

**后端**: `.env` - ✅ 已存在，可正常使用  
**前端**: `.env.development` - ✅ 已创建，可正常使用

**状态**: ✅ **配置完成，可以开始测试！**

