                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            # üìä TCM Platform Êï∞ÊçÆÂ∫ìÂÆåÊï¥ÊèèËø∞

**È°πÁõÆ**: ‰∏≠ÂåªËçØÊñπÂπ≥Âè∞  
**Êï∞ÊçÆÂ∫ì**: MySQL  
**Êõ¥Êñ∞Êó•Êúü**: 2025Âπ¥11Êúà3Êó•  
**Êï∞ÊçÆÁä∂ÊÄÅ**: ‚úÖ ÂÆåÊï¥

---

## üìà Êï∞ÊçÆÂ∫ìÊ¶ÇËßà

### Êï∞ÊçÆÂ∫ìÁªüËÆ°

| Ë°®Âêç | ËÆ∞ÂΩïÊï∞ | ËØ¥Êòé |
|------|--------|------|
| **users** | 3 | Áî®Êà∑Ë°® |
| **medicines** | 56 | ËçØÊùêË°® |
| **formulas** | 17 | ÊñπÂâÇË°® |
| **formula_composition** | 76 | ÊñπÂâÇÁªÑÊàêË°® |
| **user_collections** | 34 | Áî®Êà∑Êî∂ËóèË°® |
| **user_simulations** | 0 | Áî®Êà∑Ê®°ÊãüÊñπÊ°àË°® |
| **user_files** | 0 | Áî®Êà∑Êñá‰ª∂Ë°® |
| **refresh_tokens** | 3 | Âà∑Êñ∞‰ª§ÁâåË°® |
| **ÊÄªËÆ°** | **189** | **8‰∏™Ë°®** |

---

## üìã Êï∞ÊçÆÂ∫ìË°®ÁªìÊûÑ

### 1. users (Áî®Êà∑Ë°®)

**Áî®ÈÄî**: Â≠òÂÇ®Á≥ªÁªüÁî®Êà∑‰ø°ÊÅØ

**Â≠óÊÆµ**:

| Â≠óÊÆµÂêç | Á±ªÂûã | Á∫¶Êùü | ËØ¥Êòé |
|--------|------|------|------|
| user_id | UUID | PK | Áî®Êà∑ÂîØ‰∏ÄÊ†áËØÜ |
| username | VARCHAR(50) | UNIQUE, NOT NULL | Áî®Êà∑Âêç |
| password_hash | VARCHAR(255) | NOT NULL | ÂØÜÁ†ÅÂìàÂ∏åÂÄº |
| role | ENUM | NOT NULL | Áî®Êà∑ËßíËâ≤ |
| email | VARCHAR(100) | UNIQUE | ÈÇÆÁÆ± |
| phone | VARCHAR(20) | | ÊâãÊú∫Âè∑ |
| avatar_url | VARCHAR(255) | | Â§¥ÂÉèURL |
| created_at | DATETIME | NOT NULL | ÂàõÂª∫Êó∂Èó¥ |
| updated_at | DATETIME | NOT NULL | Êõ¥Êñ∞Êó∂Èó¥ |

**ËßíËâ≤Êûö‰∏æ**:
- `health_follower` - ÂÅ•Â∫∑ÂÖ≥Ê≥®ËÄÖ
- `student` - Â≠¶Áîü
- `teacher` - ÊïôÂ∏à

**ÂÖ≥ËÅîÂÖ≥Á≥ª**:
- ‰∏ÄÂØπÂ§ö ‚Üí `refresh_tokens`
- ‰∏ÄÂØπÂ§ö ‚Üí `user_collections`
- ‰∏ÄÂØπÂ§ö ‚Üí `user_simulations`
- ‰∏ÄÂØπÂ§ö ‚Üí `user_files`

**Á¥¢Âºï**:
- PRIMARY KEY (`user_id`)
- UNIQUE (`username`)
- UNIQUE (`email`)

---

### 2. medicines (ËçØÊùêË°®)

**Áî®ÈÄî**: Â≠òÂÇ®‰∏≠ËçØÊùê‰ø°ÊÅØ

**Â≠óÊÆµ**:

| Â≠óÊÆµÂêç | Á±ªÂûã | Á∫¶Êùü | ËØ¥Êòé |
|--------|------|------|------|
| medicine_id | UUID | PK | ËçØÊùêÂîØ‰∏ÄÊ†áËØÜ |
| name | VARCHAR(100) | UNIQUE, NOT NULL | ËçØÊùêÂêçÁß∞ |
| pinyin | VARCHAR(100) | | ÊãºÈü≥ |
| category | VARCHAR(50) | | ËçØÁ±ª |
| nature | VARCHAR(50) | | ÊÄßÂë≥ÔºàÂØíÁÉ≠Ê∏©ÂáâÂπ≥Ôºâ |
| flavor | VARCHAR(50) | | ‰∫îÂë≥ÔºàËæõÁîòÈÖ∏Ëã¶Âí∏Ôºâ |
| meridian | VARCHAR(100) | | ÂΩíÁªè |
| efficacy | TEXT | | ÂäüÊïà |
| indications | TEXT | | ‰∏ªÊ≤ª |
| usage_dosage | VARCHAR(100) | | Áî®Ê≥ïÁî®Èáè |
| contraindications | TEXT | | Á¶ÅÂøå |
| description | TEXT | | ËçØÊùêÊèèËø∞ |
| image_url | VARCHAR(255) | | ÂõæÁâáURL |
| created_at | DATETIME | NOT NULL | ÂàõÂª∫Êó∂Èó¥ |
| updated_at | DATETIME | NOT NULL | Êõ¥Êñ∞Êó∂Èó¥ |

**ÂÖ≥ËÅîÂÖ≥Á≥ª**:
- Â§öÂØπÂ§ö ‚Üí `formulas` (ÈÄöËøá `formula_composition`)

**Á¥¢Âºï**:
- PRIMARY KEY (`medicine_id`)
- UNIQUE (`name`)

**Á§∫‰æãÊï∞ÊçÆÁ±ªÂà´**:
- Ë°•Ê∞îËçØÔºö‰∫∫ÂèÇ„ÄÅÈªÑËä™„ÄÅÁôΩÊúØ„ÄÅÁîòËçâÁ≠â
- Ë°•Ë°ÄËçØÔºöÂΩìÂΩí„ÄÅÁÜüÂú∞ÈªÑ„ÄÅÁôΩËäç„ÄÅÈòøËÉ∂Á≠â
- Ê∏ÖÁÉ≠ËçØÔºöÈªÑËøû„ÄÅÈªÑËä©„ÄÅÈáëÈì∂Ëä±„ÄÅËøûÁøòÁ≠â
- Ëß£Ë°®ËçØÔºöÈ∫ªÈªÑ„ÄÅÊ°ÇÊûù„ÄÅÈò≤È£é„ÄÅËñÑËç∑Á≠â

---

### 3. formulas (ÊñπÂâÇË°®)

**Áî®ÈÄî**: Â≠òÂÇ®ÁªèÂÖ∏ÊñπÂâÇ‰ø°ÊÅØ

**Â≠óÊÆµ**:

| Â≠óÊÆµÂêç | Á±ªÂûã | Á∫¶Êùü | ËØ¥Êòé |
|--------|------|------|------|
| formula_id | UUID | PK | ÊñπÂâÇÂîØ‰∏ÄÊ†áËØÜ |
| name | VARCHAR(100) | UNIQUE, NOT NULL | ÊñπÂâÇÂêçÁß∞ |
| pinyin | VARCHAR(100) | | ÊãºÈü≥ |
| category | VARCHAR(50) | | ÊñπÂâÇÂàÜÁ±ª |
| source | VARCHAR(100) | | Âá∫Â§Ñ |
| composition_summary | TEXT | | ÁªÑÊàêÊ¶ÇËø∞ |
| efficacy | TEXT | | ÂäüÊïà |
| indications | TEXT | | ‰∏ªÊ≤ª |
| usage_dosage | TEXT | | Áî®Ê≥ïÁî®Èáè |
| contraindications | TEXT | | Á¶ÅÂøå |
| clinical_applications | TEXT | | ‰∏¥Â∫äÂ∫îÁî® |
| modifications | TEXT | | Âä†ÂáèÂèòÂåñ |
| description | TEXT | | ÊñπÂâÇÊèèËø∞ |
| created_at | DATETIME | NOT NULL | ÂàõÂª∫Êó∂Èó¥ |
| updated_at | DATETIME | NOT NULL | Êõ¥Êñ∞Êó∂Èó¥ |

**ÂÖ≥ËÅîÂÖ≥Á≥ª**:
- Â§öÂØπÂ§ö ‚Üí `medicines` (ÈÄöËøá `formula_composition`)
- ‰∏ÄÂØπÂ§ö ‚Üí `formula_composition`

**Á¥¢Âºï**:
- PRIMARY KEY (`formula_id`)
- UNIQUE (`name`)

**Áé∞ÊúâÊñπÂâÇÂàóË°®**:

1. **ÂõõÂêõÂ≠êÊ±§** - Ë°•ÁõäÂâÇ - ÁõäÊ∞îÂÅ•ËÑæ
2. **ÂõõÁâ©Ê±§** - Ë°•ÁõäÂâÇ - Ë°•Ë°ÄË∞ÉË°Ä
3. **ÂÖ´ÁèçÊ±§** - Ë°•ÁõäÂâÇ - ÁõäÊ∞îË°•Ë°Ä
4. **ÂÖ≠Âë≥Âú∞ÈªÑ‰∏∏** - Ë°•ÁõäÂâÇ - ÊªãÈò¥Ë°•ËÇæ
5. **ÈÄçÈÅ•Êï£** - Ë°•ÁõäÂâÇ - ÁñèËÇùËß£ÈÉÅÔºåÂÖªË°ÄÂÅ•ËÑæ
6. **Ê°ÇÊûùÊ±§** - Ëß£Ë°®ÂâÇ - Ëß£ËÇåÂèëË°®ÔºåË∞ÉÂíåËê•Âç´
7. **È∫ªÈªÑÊ±§** - Ëß£Ë°®ÂâÇ - ÂèëÊ±óËß£Ë°®ÔºåÂÆ£ËÇ∫Âπ≥Âñò
8. **Â∞èÊü¥ËÉ°Ê±§** - ÂíåËß£ÂâÇ - ÂíåËß£Â∞ëÈò≥
9. **Â§ßÊâøÊ∞îÊ±§** - Ê≥ª‰∏ãÂâÇ - Â≥ª‰∏ãÁÉ≠Áªì
10. **ÂΩìÂΩíË°•Ë°ÄÊ±§** - Ë°•ÁõäÂâÇ - Ë°•Ê∞îÁîüË°Ä
11. **‰∫åÈôàÊ±§** - Á•õÁó∞ÂâÇ - Áá•ÊπøÂåñÁó∞ÔºåÁêÜÊ∞îÂíå‰∏≠
12. **ÁéâÂ±èÈ£éÊï£** - Ë°•ÁõäÂâÇ - ÁõäÊ∞îÂõ∫Ë°®Ê≠¢Ê±ó
13. **Âπ≥ËÉÉÊï£** - Á•õÊπøÂâÇ - Áá•ÊπøËøêËÑæÔºåË°åÊ∞îÂíåËÉÉ
14. **‰∫îËãìÊï£** - Á•õÊπøÂâÇ - Âà©Ê∞¥Ê∏óÊπøÔºåÊ∏©Èò≥ÂåñÊ∞î
15. **Ë°ÄÂ∫úÈÄêÁòÄÊ±§** - Ê¥ªË°ÄÂåñÁòÄÂâÇ - Ê¥ªË°ÄÂåñÁòÄÔºåË°åÊ∞îÊ≠¢Áóõ
16. **ÁîüËÑâÊï£** - Ë°•ÁõäÂâÇ - ÁõäÊ∞îÁîüÊ¥•ÔºåÊïõÈò¥Ê≠¢Ê±ó
17. **Èì∂ÁøòÊï£** - Ëß£Ë°®ÂâÇ - ËæõÂáâÈÄèË°®ÔºåÊ∏ÖÁÉ≠Ëß£ÊØí

---

### 4. formula_composition (ÊñπÂâÇÁªÑÊàêË°®)

**Áî®ÈÄî**: Â≠òÂÇ®ÊñπÂâÇ‰∏éËçØÊùêÁöÑÂÖ≥ËÅîÂÖ≥Á≥ª

**Â≠óÊÆµ**:

| Â≠óÊÆµÂêç | Á±ªÂûã | Á∫¶Êùü | ËØ¥Êòé |
|--------|------|------|------|
| composition_id | UUID | PK | ÁªÑÊàêËÆ∞ÂΩïID |
| formula_id | UUID | FK, NOT NULL | ÊñπÂâÇID |
| medicine_id | UUID | FK, NOT NULL | ËçØÊùêID |
| dosage | VARCHAR(50) | | Áî®ÈáèÔºàÂ¶Ç"9g", "3-9g"Ôºâ |
| role | VARCHAR(50) | | ËçØÁâ©ËßíËâ≤ÔºàÂêõ„ÄÅËá£„ÄÅ‰Ωê„ÄÅ‰ΩøÔºâ |
| processing | VARCHAR(100) | | ÁÇÆÂà∂ÊñπÊ≥ï |
| notes | TEXT | | Â§áÊ≥® |
| created_at | DATETIME | NOT NULL | ÂàõÂª∫Êó∂Èó¥ |

**ÂÖ≥ËÅîÂÖ≥Á≥ª**:
- Â§öÂØπ‰∏Ä ‚Üí `formulas`
- Â§öÂØπ‰∏Ä ‚Üí `medicines`

**Á¥¢Âºï**:
- PRIMARY KEY (`composition_id`)
- UNIQUE (`formula_id`, `medicine_id`)
- FOREIGN KEY (`formula_id`) REFERENCES `formulas` (`formula_id`) ON DELETE CASCADE
- FOREIGN KEY (`medicine_id`) REFERENCES `medicines` (`medicine_id`)

**ËçØÁâ©ËßíËâ≤ËØ¥Êòé**:
- **ÂêõËçØ**: ÈíàÂØπ‰∏ªÁóÖÊàñ‰∏ªËØÅËµ∑‰∏ªË¶ÅÊ≤ªÁñó‰ΩúÁî®ÁöÑËçØÁâ©
- **Ëá£ËçØ**: ËæÖÂä©ÂêõËçØÂä†Âº∫Ê≤ªÁñó‰ΩúÁî®ÁöÑËçØÁâ©
- **‰ΩêËçØ**: ÈÖçÂêàÂêõËá£ËçØÁâ©ÔºåÊàñÁî®‰∫éÊ∂àÈô§ÊúâÂÆ≥Âõ†Á¥†
- **‰ΩøËçØ**: ÂºïÁªèËçØÊàñË∞ÉÂíåËçØÊÄßÁöÑËçØÁâ©

**Á§∫‰æã**:

ÂõõÂêõÂ≠êÊ±§ÁªÑÊàê:
```
‰∫∫ÂèÇ  9g  Âêõ  Â§ßË°•ÂÖÉÊ∞îÔºåÂÅ•ËÑæÂÖªËÉÉ
ÁôΩÊúØ  9g  Ëá£  ÂÅ•ËÑæÁá•Êπø
ËåØËãì  9g  ‰Ωê  Ê∏óÊπøÂÅ•ËÑæ
ÁîòËçâ  6g  ‰Ωø  ‰∏≠ÂíåË∞ÉËçØ
```

---

### 5. user_collections (Áî®Êà∑Êî∂ËóèË°®)

**Áî®ÈÄî**: Â≠òÂÇ®Áî®Êà∑Êî∂ËóèÁöÑËçØÊùêÂíåÊñπÂâÇ

**Â≠óÊÆµ**:

| Â≠óÊÆµÂêç | Á±ªÂûã | Á∫¶Êùü | ËØ¥Êòé |
|--------|------|------|------|
| collection_id | UUID | PK | Êî∂ËóèËÆ∞ÂΩïID |
| user_id | UUID | FK, NOT NULL | Áî®Êà∑ID |
| content_type | ENUM | NOT NULL | ÂÜÖÂÆπÁ±ªÂûã |
| content_id | UUID | NOT NULL | ÂÜÖÂÆπID |
| created_at | DATETIME | NOT NULL | Êî∂ËóèÊó∂Èó¥ |

**ÂÜÖÂÆπÁ±ªÂûãÊûö‰∏æ**:
- `medicine` - ËçØÊùê
- `formula` - ÊñπÂâÇ

**ÂÖ≥ËÅîÂÖ≥Á≥ª**:
- Â§öÂØπ‰∏Ä ‚Üí `users`
- ÂèØÂÖ≥ËÅî ‚Üí `formulas` (ÂΩìcontent_type‰∏∫'formula')

**Á¥¢Âºï**:
- PRIMARY KEY (`collection_id`)
- UNIQUE (`user_id`, `content_type`, `content_id`)
- INDEX (`user_id`)

**ÁâπÁÇπ**:
- ÊîØÊåÅÁÅµÊ¥ªÁöÑÂÜÖÂÆπÁ±ªÂûã
- Èò≤Ê≠¢ÈáçÂ§çÊî∂Ëóè
- ‰∏çÂàõÂª∫Â§ñÈîÆÁ∫¶ÊùüÔºàÂõ†‰∏∫Áî®‰∫éÂ§öÁßçÁ±ªÂûãÔºâ

---

### 6. user_simulations (Áî®Êà∑Ê®°ÊãüÊñπÊ°àË°®)

**Áî®ÈÄî**: Â≠òÂÇ®Áî®Êà∑‰øùÂ≠òÁöÑÈÖçÊñπÊ®°ÊãüÊñπÊ°à

**Â≠óÊÆµ**:

| Â≠óÊÆµÂêç | Á±ªÂûã | Á∫¶Êùü | ËØ¥Êòé |
|--------|------|------|------|
| simulation_id | UUID | PK | Ê®°ÊãüÊñπÊ°àID |
| user_id | UUID | FK, NOT NULL | Áî®Êà∑ID |
| name | VARCHAR(200) | NOT NULL | ÊñπÊ°àÂêçÁß∞ |
| composition_data | JSON | NOT NULL | ÈÖçÊñπÁªÑÊàêÊï∞ÊçÆ |
| ai_analysis_data | JSON | | AIÂàÜÊûêÁªìÊûú |
| user_notes | TEXT | | Áî®Êà∑Â§áÊ≥® |
| created_at | DATETIME | NOT NULL | ÂàõÂª∫Êó∂Èó¥ |
| updated_at | DATETIME | NOT NULL | Êõ¥Êñ∞Êó∂Èó¥ |

**ÂÖ≥ËÅîÂÖ≥Á≥ª**:
- Â§öÂØπ‰∏Ä ‚Üí `users`

**Á¥¢Âºï**:
- PRIMARY KEY (`simulation_id`)
- INDEX (`user_id`, `created_at`)

**Êï∞ÊçÆÊ†ºÂºèÁ§∫‰æã**:

composition_data:
```json
[
  {
    "medicine_id": "xxx",
    "name": "‰∫∫ÂèÇ",
    "dosage": "9g"
  },
  ...
]
```

ai_analysis_data:
```json
{
  "overall_properties": {
    "nature": "Ê∏©",
    "flavor": ["Áîò", "ÂæÆËã¶"],
    "meridian": ["ËÑæ", "ËÇ∫"]
  },
  "functions_analysis": {
    "Ë°•Ê∞î": 10,
    "ÂÅ•ËÑæ": 8
  }
}
```

---

### 7. user_files (Áî®Êà∑Êñá‰ª∂Ë°®)

**Áî®ÈÄî**: Â≠òÂÇ®ÊïôÂ∏à‰∏ä‰º†ÁöÑÊñá‰ª∂ÂÖÉÊï∞ÊçÆ

**Â≠óÊÆµ**:

| Â≠óÊÆµÂêç | Á±ªÂûã | Á∫¶Êùü | ËØ¥Êòé |
|--------|------|------|------|
| file_id | UUID | PK | Êñá‰ª∂ID |
| user_id | UUID | FK, NOT NULL | Áî®Êà∑IDÔºàÊïôÂ∏àÔºâ |
| file_name | VARCHAR(255) | NOT NULL | Êñá‰ª∂Âêç |
| storage_url | VARCHAR(500) | NOT NULL | Â≠òÂÇ®URL |
| file_type | VARCHAR(100) | | Êñá‰ª∂MIMEÁ±ªÂûã |
| file_size | BIGINT | | Êñá‰ª∂Â§ßÂ∞èÔºàÂ≠óËäÇÔºâ |
| uploaded_at | DATETIME | NOT NULL | ‰∏ä‰º†Êó∂Èó¥ |

**ÂÖ≥ËÅîÂÖ≥Á≥ª**:
- Â§öÂØπ‰∏Ä ‚Üí `users`

**Á¥¢Âºï**:
- PRIMARY KEY (`file_id`)
- INDEX (`user_id`, `uploaded_at`)

**Áî®ÈÄî**:
- ÊïôÂ∏à‰∏ä‰º†ÊïôÂ≠¶ËµÑÊñô
- Â≠òÂÇ®Âà∞ÂØπË±°Â≠òÂÇ®ÔºàD8Ôºâ
- ËÆ∞ÂΩïÊñá‰ª∂ÂÖÉÊï∞ÊçÆ

---

### 8. refresh_tokens (Âà∑Êñ∞‰ª§ÁâåË°®)

**Áî®ÈÄî**: Â≠òÂÇ®Áî®Êà∑Âà∑Êñ∞‰ª§Áâå

**Â≠óÊÆµ**:

| Â≠óÊÆµÂêç | Á±ªÂûã | Á∫¶Êùü | ËØ¥Êòé |
|--------|------|------|------|
| token_id | UUID | PK | ‰ª§ÁâåID |
| user_id | UUID | FK, NOT NULL | Áî®Êà∑ID |
| token | VARCHAR(512) | UNIQUE, NOT NULL | Âà∑Êñ∞‰ª§Áâå |
| expires_at | DATETIME | NOT NULL | ËøáÊúüÊó∂Èó¥ |
| created_at | DATETIME | NOT NULL | ÂàõÂª∫Êó∂Èó¥ |

**ÂÖ≥ËÅîÂÖ≥Á≥ª**:
- Â§öÂØπ‰∏Ä ‚Üí `users`

**Á¥¢Âºï**:
- PRIMARY KEY (`token_id`)
- UNIQUE (`token`)
- FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`) ON DELETE CASCADE

**Áî®ÈÄî**:
- JWTÂà∑Êñ∞‰ª§ÁâåÁÆ°ÁêÜ
- ÊîØÊåÅtokenËøáÊúüÂíåÊí§ÈîÄ
- ‰øùÈöúÁî®Êà∑‰ºöËØùÂÆâÂÖ®

---

## üîó ÂÆû‰ΩìÂÖ≥Á≥ªÂõæ (ERD)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     users       ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ user_id (PK)    ‚îÇ
‚îÇ username        ‚îÇ
‚îÇ password_hash   ‚îÇ
‚îÇ role            ‚îÇ
‚îÇ email           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                                        ‚îÇ
         ‚îÇ                                        ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇrefresh_tokens ‚îÇ                    ‚îÇuser_collections  ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇtoken_id (PK)  ‚îÇ                    ‚îÇcollection_id(PK) ‚îÇ
    ‚îÇuser_id (FK)   ‚îÇ                    ‚îÇuser_id (FK)      ‚îÇ
    ‚îÇtoken          ‚îÇ                    ‚îÇcontent_type      ‚îÇ
    ‚îÇexpires_at     ‚îÇ                    ‚îÇcontent_id        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇuser_simulations   ‚îÇ          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§          ‚îÇ   medicines  ‚îÇ
    ‚îÇsimulation_id(PK)  ‚îÇ          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇuser_id (FK)       ‚îÇ          ‚îÇmedicine_id(PK‚îÇ
    ‚îÇname               ‚îÇ          ‚îÇname          ‚îÇ
    ‚îÇcomposition_data   ‚îÇ          ‚îÇnature        ‚îÇ
    ‚îÇai_analysis_data   ‚îÇ          ‚îÇflavor        ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇefficacy      ‚îÇ
                                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                          ‚îÇ
         ‚îÇ                                ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
    ‚îÇ  user_files   ‚îÇ                    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                    ‚îÇ
    ‚îÇfile_id (PK)   ‚îÇ                    ‚îÇ
    ‚îÇuser_id (FK)   ‚îÇ          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇfile_name      ‚îÇ          ‚îÇformula_composition     ‚îÇ
    ‚îÇstorage_url    ‚îÇ          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇcomposition_id (PK)     ‚îÇ
                               ‚îÇformula_id (FK)         ‚îÇ
                               ‚îÇmedicine_id (FK)        ‚îÇ
                               ‚îÇdosage                  ‚îÇ
                               ‚îÇrole                    ‚îÇ
                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                        ‚îÇ
                               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                               ‚îÇ    formulas     ‚îÇ
                               ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                               ‚îÇformula_id (PK)  ‚îÇ
                               ‚îÇname             ‚îÇ
                               ‚îÇcategory         ‚îÇ
                               ‚îÇefficacy         ‚îÇ
                               ‚îÇindications      ‚îÇ
                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä Êï∞ÊçÆÂÆåÊï¥ÊÄß

### Â§ñÈîÆÁ∫¶Êùü

| Â≠êË°® | Â§ñÈîÆÂ≠óÊÆµ | Áà∂Ë°® | Áà∂Ë°®Â≠óÊÆµ | Êìç‰Ωú |
|------|---------|------|---------|------|
| refresh_tokens | user_id | users | user_id | CASCADE |
| user_collections | user_id | users | user_id | CASCADE |
| user_simulations | user_id | users | user_id | CASCADE |
| user_files | user_id | users | user_id | CASCADE |
| formula_composition | formula_id | formulas | formula_id | CASCADE |
| formula_composition | medicine_id | medicines | medicine_id | RESTRICT |

---

### ÂîØ‰∏ÄÊÄßÁ∫¶Êùü

| Ë°®Âêç | ÂîØ‰∏ÄÁ∫¶ÊùüÂ≠óÊÆµ |
|------|------------|
| users | username, email |
| medicines | name |
| formulas | name |
| formula_composition | (formula_id, medicine_id) |
| user_collections | (user_id, content_type, content_id) |
| refresh_tokens | token |

---

## üîç Êü•ËØ¢Á§∫‰æã

### Êü•ËØ¢ÊñπÂâÇÂèäÂÖ∂ÁªÑÊàê

```sql
SELECT 
  f.name AS formula_name,
  f.efficacy,
  m.name AS medicine_name,
  fc.dosage,
  fc.role
FROM formulas f
LEFT JOIN formula_composition fc ON f.formula_id = fc.formula_id
LEFT JOIN medicines m ON fc.medicine_id = m.medicine_id
WHERE f.name = 'ÂõõÂêõÂ≠êÊ±§';
```

**ÁªìÊûú**:
```
formula_name   efficacy    medicine_name   dosage   role
ÂõõÂêõÂ≠êÊ±§      ÁõäÊ∞îÂÅ•ËÑæ     ‰∫∫ÂèÇ            9g       Âêõ
ÂõõÂêõÂ≠êÊ±§      ÁõäÊ∞îÂÅ•ËÑæ     ÁôΩÊúØ            9g       Ëá£
ÂõõÂêõÂ≠êÊ±§      ÁõäÊ∞îÂÅ•ËÑæ     ËåØËãì            9g       ‰Ωê
ÂõõÂêõÂ≠êÊ±§      ÁõäÊ∞îÂÅ•ËÑæ     ÁîòËçâ            6g       ‰Ωø
```

---

### Êü•ËØ¢Áî®Êà∑Êî∂Ëóè

```sql
SELECT 
  uc.collection_id,
  uc.content_type,
  COALESCE(m.name, f.name) AS content_name,
  uc.created_at
FROM user_collections uc
LEFT JOIN medicines m ON uc.content_type = 'medicine' AND uc.content_id = m.medicine_id
LEFT JOIN formulas f ON uc.content_type = 'formula' AND uc.content_id = f.formula_id
WHERE uc.user_id = 'xxx';
```

---

### ÁªüËÆ°ÊØè‰∏™ÊñπÂâÇÁöÑËçØÊùêÊï∞Èáè

```sql
SELECT 
  f.name,
  f.category,
  COUNT(fc.medicine_id) AS medicine_count
FROM formulas f
LEFT JOIN formula_composition fc ON f.formula_id = fc.formula_id
GROUP BY f.formula_id, f.name, f.category
ORDER BY medicine_count DESC;
```

---

## üéØ Êï∞ÊçÆÂ∫ìÁâπÁÇπ

### 1. Êï∞ÊçÆÊ®°ÂûãËÆæËÆ°

- ‚úÖ **ËßÑËåÉÂåñ**: Á¨¶ÂêàÁ¨¨‰∏âËåÉÂºè
- ‚úÖ **ÁÅµÊ¥ªÊÄß**: ÊîØÊåÅÂ§öÁßçÂÜÖÂÆπÁ±ªÂûã
- ‚úÖ **Êâ©Â±ïÊÄß**: JSONÂ≠óÊÆµÊîØÊåÅÂ§çÊùÇÊï∞ÊçÆÁªìÊûÑ
- ‚úÖ **ÂÆåÊï¥ÊÄß**: Â§ñÈîÆÁ∫¶Êùü‰øùÈöúÊï∞ÊçÆ‰∏ÄËá¥ÊÄß

---

### 2. ÊÄßËÉΩ‰ºòÂåñ

- ‚úÖ **Á¥¢Âºï‰ºòÂåñ**: ÂÖ≥ÈîÆÂ≠óÊÆµÂª∫Á´ãÁ¥¢Âºï
- ‚úÖ **ÂîØ‰∏ÄÁ∫¶Êùü**: Èò≤Ê≠¢ÈáçÂ§çÊï∞ÊçÆ
- ‚úÖ **ÂÖ≥ËÅî‰ºòÂåñ**: ÂêàÁêÜ‰ΩøÁî®Á∫ßËÅîÂà†Èô§

---

### 3. ÂÆâÂÖ®ÊÄß

- ‚úÖ **ÂØÜÁ†ÅÂìàÂ∏å**: ‰∏çÂ≠òÂÇ®ÊòéÊñáÂØÜÁ†Å
- ‚úÖ **UUID‰∏ªÈîÆ**: Èò≤Ê≠¢‰∏ªÈîÆÁåúÊµã
- ‚úÖ **‰ª§ÁâåÁÆ°ÁêÜ**: ÊîØÊåÅtokenËøáÊúüÂíåÊí§ÈîÄ

---

## üìù Êï∞ÊçÆÁª¥Êä§

### ÂØºÂÖ•ËÑöÊú¨

**Êñá‰ª∂**: `import-json-data.js`

**ÂäüËÉΩ**:
- ‰ªéJSONÊñá‰ª∂ÂØºÂÖ•ËçØÊùêÂíåÊñπÂâÇ
- Ëá™Âä®ÂéªÈáç
- ‰∫ãÂä°‰øùÊä§
- ÊâπÈáèÊèíÂÖ•‰ºòÂåñ

**‰ΩøÁî®**:
```bash
node import-json-data.js
```

---

### Êï∞ÊçÆÂ§á‰ªΩ

**mysqldumpÂëΩ‰ª§**:
```bash
mysqldump -u root -p tcm_platform > backup.sql
```

**ÊÅ¢Â§ç**:
```bash
mysql -u root -p tcm_platform < backup.sql
```

---

## ‚úÖ Êï∞ÊçÆÂ∫ìÁä∂ÊÄÅÊÄªÁªì

| È°πÁõÆ | Áä∂ÊÄÅ |
|------|------|
| **Ë°®Êï∞Èáè** | 8‰∏™ |
| **ÊÄªËÆ∞ÂΩïÊï∞** | 189Êù° |
| **ÂÖ≥ËÅîÂÖ≥Á≥ª** | Ê≠£Â∏∏ |
| **Á¥¢Âºï** | ÂÆåÊï¥ |
| **Á∫¶Êùü** | ÂÆåÂñÑ |
| **Êï∞ÊçÆË¥®Èáè** | ‰ºòÁßÄ |

---

**Êï∞ÊçÆÂ∫ìÁâàÊú¨**: v1.0  
**ÊúÄÂêéÊõ¥Êñ∞**: 2025Âπ¥11Êúà3Êó•  
**Áä∂ÊÄÅ**: ‚úÖ **ËøêË°åÊ≠£Â∏∏ÔºåÊï∞ÊçÆÂÆåÊï¥**

